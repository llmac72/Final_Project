---
title: "Final_Project"
author: "Adam Brandt, Allan Juarez, John King, Lisa McDaniel, Colin Willenborg (Project Coordinator)"
date: "11/10/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<font size="5"> **Introduction**  
<font size="3">  

The 5 Year program is prepared by the Iowa Department of Transportation (Iowa DOT) and identifies transportation projects planned for construction on a annual basis for a period of five years, in this case 2021-2025.  The program includes projects for aviation, transit, railroad, safety, trails and highway.  Project location, county, work type, route, length and annual construction costs are included in the program for each project listed.  The document is updated annually by removing completed projects, introducing new projects, revising project schedules and costs and rescheduling projects as needed.  It is approved by the Iowa DOT commission and provides transparency to the public by being available on the Iowa DOT's website. 

Information in the 5 Year Program assists the Iowa DOT, local public agencies and the federal government in developing a budget, identify needs, project status, documentation requirements and staffing resources.  The document also makes it easier for organizations to compare estimated project costs with actual project costs and track project costs/status over the years, across the state/county and by project.  There is a lot of information in the 5 Year Program, so we focused our analysis on the highway program, which begins on page 50.

<font size="5">**Dataset Overview**
<font size="3">

The 5 Year Program can be found on the Iowa DOT's website at:


<div align="center">https://iowadot.gov/program_management/FINAL_2021-2025_5YrProg.pdf</div><br>

The 5 Year Program was originally created as a pdf and exported to an excel spreadsheet.  The conversion was a bit messy so quality assurance (QA) was done to ensure that project costs were correct and in the correct year.  Several columns were added to the dataset including Iowa DOT District, county latitude and longitude and projects rescheduled in case the Highway Trust Funds becomes insolvent. We also *filled down* the project location and miles for each work type and renamed several columns.  As each of us explored the data, we continued to make various changes/revisions specific to our individual analysis.

```{r message=FALSE, echo = TRUE, results = "hide"}

library(readxl)
library(tidyverse)
library(dplyr)

FiveYear <- read_excel('./2021_2025_5YrProg_Highway_Program.xlsx')

str(FiveYear) 
names(FiveYear)

FiveYear <- FiveYear %>% 
  fill(Location, .direction = "down") %>% 
  rename(District = `Iowa DOT District`, Route = `Project Route`, 
         Work = `Type of Work`) %>%
  group_by(County, District, Route, Location) %>%
  fill(Miles, .direction = "down") %>%
  mutate(District = as.numeric(District))
  

```


## Allan Juarez

<font size="3"> 

* Type, number, route, and location by County and estimated costs of projects planned between 2021 â€“ 2025.  Where is the money going and how much?

```{r }
states <- map_data('state')
us_counties <- map_data("county")

twentyone <- FiveYear %>% 
  select(County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2021") %>%
  rename(year ="2021")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(subregion) %>% 
  summarize(total = sum(year,na.rm=TRUE))

 
iowa <- c("iowa")
us_counties <- us_counties %>% filter(region %in% iowa)
twentyone <- inner_join(twentyone, us_counties, by = "subregion")
 twentyone %>% ggplot(data = twentyone,
            mapping = aes(x = long, y = lat,
                          group = group, fill = total))+ geom_polygon(color = "gray90", size = 0.1) 
 
 twentytwo <- FiveYear %>% 
  select(County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2022") %>%
  rename(year ="2022")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(subregion) %>% 
  summarize(total = sum(year,na.rm=TRUE))

 

twentytwo <- inner_join(twentytwo, us_counties, by = "subregion")
 twentytwo %>% ggplot(data = twentytwo,
            mapping = aes(x = long, y = lat,
                          group = group, fill = total))+ geom_polygon(color = "gray90", size = 0.1)
 
twentythree <- FiveYear %>% 
  select(County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2023") %>%
  rename(year ="2023")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(subregion) %>% 
  summarize(total = sum(year,na.rm=TRUE))

 

twentythree <- inner_join(twentythree, us_counties, by = "subregion")
 twentythree %>% ggplot(data = twentythree,
            mapping = aes(x = long, y = lat,
                          group = group, fill = total))+ geom_polygon(color = "gray90", size = 0.1) 
 
twentyfour <- FiveYear %>% 
  select(County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2024") %>%
  rename(year ="2024")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(subregion) %>% 
  summarize(total = sum(year,na.rm=TRUE))

 

twentyfour <- inner_join(twentyfour, us_counties, by = "subregion")
 twentyfour %>% ggplot(data = twentyfour,
            mapping = aes(x = long, y = lat,
                          group = group, fill = total))+ geom_polygon(color = "gray90", size = 0.1)
 
twentyfive <- FiveYear %>% 
  select(County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2025") %>%
  rename(year ="2025")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(subregion) %>% 
  summarize(total = sum(year,na.rm=TRUE))

 
twentyfive <- inner_join(twentyfive, us_counties, by = "subregion")
 twentyfive %>% ggplot(data = twentyfive,
            mapping = aes(x = long, y = lat,
                          group = group, fill = total))+ geom_polygon(color = "gray90", size = 0.1)
 
 type <- FiveYear %>% select(Work) %>% group_by(Work) %>% tally() %>% arrange(desc(n))
 head(type,n=10)
  ggplot(head(type,n=10) , aes(Work, n)) + geom_bar(position="dodge",stat="identity")+coord_flip()
  
  
 county <- FiveYear %>% select(County) %>% group_by(County) %>% tally() %>% arrange(desc(n))
 county
```

## John King

<font size="3"> 

* What work types are associated with interchanges?  Costs? What routes are interchanges being proposed on?

```{r }

```

## Adam Brandt

<font size="3"> 

* Projects < $50 million, projects > $50 million & < $100 million, major projects > $100.  What is the most expensive project in each District?  The least expensive?
```{r }
projects <- FiveYear %>% 
  select(District, County, Route, 'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)", "2021", "2022", "2023", "2024", "2025") %>%
  mutate(subregion = tolower(County)) %>% 
  group_by(County, District, Route, Location) %>% 
  summarise(cost = sum(`2021`, `2022`, `2023`, `2024`, `2025`,  na.rm=TRUE))
max_projects <- projects %>% arrange(-cost)
head(max_projects)
min_projects <- projects %>% arrange(cost)
head(min_projects)
max_by_district <- projects %>% group_by(District) %>% slice(which.max(cost))
head(max_by_district)
min_by_district <-projects %>% group_by(District) %>% slice(which.min(cost))
head(min_by_district)
range <- split(projects, cut(projects$cost, c(0, 50000, 100000, 1000000)))
head(range)
```
There are 629 projects that are less than $50 million, 6 projects that are between $50 and $100 million, and 4 projects that are more than $100 million. The costs are the total cost of the project over the five years. The cost column is in thousands of dollars. The most expensive project is the I-29/80/480 INTERSTATES IN COUNCIL BLUFFS (CBIS) at $319,603,000 and the least expensive project is 	1.8 MI W OF DES MOINES RIVER TO W OF SNEDDEN DR at $2000.

## Colin Willenborg(Project Coordinator)

<font size="3"> 

* Project types and costs between Iowa DOT Districts and years.

```{r}
head(FiveYear)
districts <- FiveYear %>% 
  select(County, District) %>% 
  mutate(subregion = tolower(County))

county_map <- map_data("county")
ia <- subset(county_map, region =="iowa")

districts_2021 <- FiveYear %>% 
  select(District, County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2021") %>%
  rename(year ="2021")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(District) %>% 
  summarize(total = sum(year,na.rm=TRUE))

ia <- inner_join(ia, districts, by="subregion")

districts_2021 <- inner_join(districts_2021, ia, by = "District")

districts_2021 %>% ggplot(aes(x = long, y = lat, fill=District)) + geom_polygon(aes(group=group,fill = total), color="gray60", size=0.1)

districts_2022 <- FiveYear %>% 
  select(District, County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2022") %>%
  rename(year ="2022")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(District) %>% 
  summarize(total = sum(year,na.rm=TRUE))

districts_2022 <- inner_join(districts_2022, ia, by = "District")

districts_2022 %>% ggplot(aes(x = long, y = lat, fill=District)) + geom_polygon(aes(group=group,fill = total), color="gray60", size=0.1)

# 2023
districts_2023 <- FiveYear %>% 
  select(District, County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2023") %>%
  rename(year ="2023")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(District) %>% 
  summarize(total = sum(year,na.rm=TRUE))

districts_2023 <- inner_join(districts_2023, ia, by = "District")

districts_2023 %>% ggplot(aes(x = long, y = lat, fill=District)) + geom_polygon(aes(group=group,fill = total), color="gray60", size=0.1)

# 2024
districts_2024 <- FiveYear %>% 
  select(District, County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2024") %>%
  rename(year ="2024")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(District) %>% 
  summarize(total = sum(year,na.rm=TRUE))

districts_2024 <- inner_join(districts_2024, ia, by = "District")

districts_2024 %>% ggplot(aes(x = long, y = lat, fill=District)) + geom_polygon(aes(group=group,fill = total), color="gray60", size=0.1)

# 2025
districts_2025 <- FiveYear %>% 
  select(District, County,'Latitude\r\n(Decimal(', "Longitude\r\n(Decimal)","2025") %>%
  rename(year ="2025")%>%
  mutate(subregion = tolower(County)) %>% 
  group_by(District) %>% 
  summarize(total = sum(year,na.rm=TRUE))

districts_2025 <- inner_join(districts_2025, ia, by = "District")

districts_2025 %>% ggplot(aes(x = long, y = lat, fill=District)) + geom_polygon(aes(group=group,fill = total), color="gray60", size=0.1)

```

## Lisa McDaniel

<font size="3"> 

So we've seen the impacts of the 5 Year Program at a state level but how can the program be used at a national level?

The code of federal regulation, 23 CFR 515,  requires states to develop an asset management plan that describes how they will manage the national highway system in a financially responsible manner.  There are a lot of requirements in developing the asset management plan, including how other planning documents, such as the 5 Year Program, contribute to managing their assets.  By law, the Iowa DOT only has to include bridge/culvert and pavement assets.  Implementation of the asset management plan is reviewed on an annual basis.  There are penalties if states don't develop and implement an asset management plan according to federal law.

The analysis I performed focuses on how the Iowa DOT's 5 Year program contributes to managing their bridge and pavement assets and compares funding levels in the 5 Year Program to those in the asset management plan.

The Iowa DOT's asset management plan was approved last in 2019 and can be found on their website at:

<div align="center">https://iowadot.gov/systems_planning/fpmam/IowaDOT-TAMP-2019.pdf</div><br>

* How/do bridge/culvert work types relate to the federal work types:  construction, replacement, reconstruction, maintenance or preservation?  

* How do funding levels in the 5 Year Program compare to those in the Asset Management Plan?

* Compare the five year total of the 5 Year Program to the Asset Management Plan

<font size="5"> Bridge Assets

```{r }

```

<font size="5"> Pavement Assets

<font size="3"> 

* How/do pavement work types relate to the federal work types:  construction, replacement, reconstruction, maintenance or preservation?  

* How do funding levels in the 5 Year Program compare to those in the Asset Management Plan?

* Compare the five year total of the 5 Year Program to the Asset Management Plan

```{r }

```